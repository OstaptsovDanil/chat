## Запуск
Весь проект завернут в docker compose, который включает в себя все необходимое

Для запуска необходимо выполнить сборку и запуск контейнеров:

1. В корне проекта создайте `.env` файл. Пример его содержимого есть в `.env.example`
2. `docker compose build`
3. `docler compose up`


## Документация
### HTTP
Сваггер проета находится по адресу http://127.0.0.1:8000/docs

### WevSocket
Путь для подключения к сокетам - `/chats/ws`. В квери параметрах необходимо передать аргумент `token` с токеном авторизации для подключения.

Есть два события, которые клиент может слать:

1. Отправка сообщения:
   Формат:
  ```JSON
  {
    type: "new_message",
    chat_id: 1,
    text: "string"
  }
  ```
В ответ на это событие сервер создаст сообщение в БД и отправит все пользователям, находящимся в этом чате, уведомление о новом сообщении

2. Прочитка сообщения:
   Формат:
  ```JSON
  {
    type: "read_message",
    chat_id: 1,
    id: 1  # id сообщения
  }
  ```
В ответ на это событие сервер сдвинет курсов прочитки отправителя события и отправит уведомление о прочетнии автору сообщения


## Обзор
Построена база данных на PostgresSQL с миграциями Alembic.

Статус прочитки сообщений определятеся по курсорам (ReadCursor), поле message_id указывает на последнее прочитанное пользователем сообщение
В API списка сообщений помимо самих сообщений возвращаются также курсоры прочитки всех пользователей в чате. Это сделано для того, чтобы можно было на стороне клиента отобразить, кто именно прочитал сообщение. Общая проверка статуса прочитки должна определятся также на стороне клиента (если id сообщения <= message_id курсора, то сообщение считается прочитанным юзером курсора)

Для создания пользователя можно использовать `/users/register`, а для получения токена авторизации - `/users/login`. 
На данный момент нет хуков создания чатов, так как такого требования не было в тз. Все чаты придется создавать вручную, подключаясь к базе. При создании чата убедитесь, что у всех пользователей, которые в нем находятся, создан курсор прочитки сообщений для этого чата.
пер
Также на данном этапе проект плохо горизонтально масштабируется, так как менеджер сокетов лежит в оперативной памяти одного инстанса. Если будет поднято два, то сообщения будут доходить не до всех пользователей/чатов. Проблему можно решить, например, подключив Redis PubSub для передачи данных между инстансами приложения
